<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<hta:application id="ohta" applicationname="qsgsext" border="thin" borderstyle="normal" caption="yes" icon="../QSanguosha.exe" maximizebutton="no" 
	minimizebutton="yes" showintaskbar="yes" ingleinstance="no" sysmenu="yes" version="1.0" windowstate="normal" />
<link href="./js/zg.css" rel="stylesheet" type="text/css">
<title>成就系统for太阳神三国杀</title> 
<script type="text/javascript" language="javascript" src="./js/jquery-1.4.2.min.js"></script>
<script type="text/javascript" language="javascript" src="./js/jquery.table.js"></script>
<script type="text/javascript" language="javascript" src="./js/template.min.js"></script>
<script type="text/javascript" language="javascript" src="./js/trans.js"></script>	
<script type="text/javascript">
	var data={};
	var zglist=["zhonghe","wei","shu","wu","qun","god","3v3","1v1"];
	(function(){		
		try{
			var db = new ActiveXObject("LiteX.LiteConnection");
		}catch(x){
			return alert("请先运行bat文件注册sqlite3.dll")
		}
		db.open("zhangong.data");
		var ds = new ActiveXObject("LiteX.LiteStatement");
		ds.ActiveConnection = db

		var sql = "select skillname,gained,used,gained-used as remainnum from skills order by remainnum desc";
		var collist="skillname,gained,used,remainnum";
		data.skills=dbquery(sql,collist);

		var sql = "select datetime(id,'unixepoch','localtime') as gametime,* from results order by id desc limit 300";
		var collist="gametime,id,general,role,kingdom,hegemony,mode,turncount,alive,result,wen,wu,expval";
		data.results=dbquery(sql,collist);
		
		$.each(zglist,function(i,val){
			var sql = "select * from zhangong where category='"+val+"' order by general,num asc";
			var collist="id,name,score,description,gained,category,lasttime,general,num";
			data["zg"+val]=dbquery(sql,collist);
		});

		function dbquery(sql,collist){
			var ds=db.prepare(sql);
			var ret=[]
			while (!ds.Step()){
				var arr=[];
				var cols=collist.split(",")
				for (var i=0;i<cols.length;i++){
					arr[ds.ColumnName(i)]=ds.ColumnValue(cols[i])
				}
				ret.push(arr);
			}
			return ret;
		}		
		ds.close();
		try{
			db.close()
		}catch(x){}
	})()
	/*
		经验值,经验等级
		战功个数，战功经验

		文功 文等级， 文官职
		武功 武等级， 武官职		

		shenfen:
			胜，负，逃
			主，忠，内，反，的胜率
			总胜率		
		3v3:
			胜，负，逃
			主帅，前锋，的胜率
			总胜率
		1v1:
			胜，负，逃
			先手，后手，的胜率
			总胜率
		虎牢关:
			胜，负，逃
			先手，后手，的胜率
			总胜率
		国战:
			胜，负，逃
			先手，后手，的胜率
			总胜率
	*/
</script>
</head>
<body>

<script id="t_overview" type="text/html">
</script>

<script id="t_skills" type="text/html">
<table border width="100%" id="tbl_skills">
<thead>
	<tr>
	<th>技能卡</th><th>总数</th><th>剩余</th>
	<th>技能卡</th><th>总数</th><th>剩余</th>
	<th>技能卡</th><th>总数</th><th>剩余</th>
	<th>技能卡</th><th>总数</th><th>剩余</th>
	<th>技能卡</th><th>总数</th><th>剩余</th>
	</tr>
</thead>
<tbody>
    <% for (i = 0; i<skills.length; i+=5) { %>
        <tr>
		<td><%= getTrans(skills[i].skillname) %></td><td><%= skills[i].gained %></td><td><%= skills[i].remainnum %></td>
		<td><%= getTrans(skills[i+1].skillname) %></td><td><%= skills[i+1].gained %></td><td><%= skills[i+1].remainnum %></td>
		<td><%= getTrans(skills[i+2].skillname) %></td><td><%= skills[i+2].gained %></td><td><%= skills[i+2].remainnum %></td>
		<td><%= getTrans(skills[i+3].skillname) %></td><td><%= skills[i+3].gained %></td><td><%= skills[i+3].remainnum %></td>
		<td><%= getTrans(skills[i+4].skillname) %></td><td><%= skills[i+4].gained %></td><td><%= skills[i+4].remainnum %></td>
		</tr>
    <% } %>
</tbody>
</table>
</script>

<script id="t_results" type="text/html">
<div class="divtitle">显示最近300场游戏记录:</div>
<table border width="100%" id="tbl_results">
<thead>	
	<tr>
		<th>游戏时间</th>
		<th>武将</th>
		<th>角色</th>
		<th>开启国战</th>
		<th>游戏模式</th>		
		<th>回合数</th>
		<th>最后存活</th>
		<th>结果</th>
		<th>文功</th>
		<th>武功</th>
		<th>经验</th>		
	</tr>
</thead>	
<tbody>
    <% for (i = 0; i<results.length; i ++) { %>
	<tr>
		<td><%= results[i].gametime %></td>
		<td><%= getGeneral(results[i].general) %></td>
		<td><%= getRole(results[i].role) %></td>
		<td align="center"><%= getStatus(results[i].hegemony) %></td>
		<td><%= getTrans(results[i].mode) %></td>
		<td><%= results[i].turncount %></td>
		<td  align="center"><%= getStatus(results[i].alive) %></td>
		<td><%= getTrans(results[i].result) %></td>
		<td><%= results[i].wen %></td>
		<td><%= results[i].wu %></td>
		<td><%= results[i].expval %></td>		
	</tr>
    <% } %>	
</tbody>
</table>
</script>

<script id='t_zhonghe' type='text/html'>
<table border width='100%' id='tbl_zhonghe'>
<tbody>
    <% for (i = 0; i<zgzhonghe.length; i+=10) { %>		
    <tr>
		<% for (j = 0; j<10; j++) { %>
			<td><%= getZgInfo(zgzhonghe[i+j]) %></td>
		<% } %>			
	</tr>
    <% } %>	
</tbody>
</table>
</script>

<script id='t_wei' type='text/html'>
<table border width='100%' id='tbl_wei'>
<tbody>
    <% for (i = 0; i<zgwei.length; i+=10) { %>		
    <tr>
		<% for (j = 0; j<10; j++) { %>
			<td><%= getZgInfo(zgwei[i+j]) %></td>
		<% } %>			
	</tr>
    <% } %>	
</tbody>
</table>
</script>

<script id='t_shu' type='text/html'>
<table border width='100%' id='tbl_shu'>
<tbody>
    <% for (i = 0; i<zgshu.length; i+=10) { %>		
    <tr>
		<% for (j = 0; j<10; j++) { %>
			<td><%= getZgInfo(zgshu[i+j]) %></td>
		<% } %>			
	</tr>
    <% } %>	
</tbody>
</table>
</script>

<script id='t_wu' type='text/html'>
<table border width='100%' id='tbl_wu'>
<tbody>
    <% for (i = 0; i<zgwu.length; i+=10) { %>		
    <tr>
		<% for (j = 0; j<10; j++) { %>
			<td><%= getZgInfo(zgwu[i+j]) %></td>
		<% } %>			
	</tr>
    <% } %>	
</tbody>
</table>
</script>

<script id='t_qun' type='text/html'>
<table border width='100%' id='tbl_qun'>
<tbody>
    <% for (i = 0; i<zgqun.length; i+=10) { %>		
    <tr>
		<% for (j = 0; j<10; j++) { %>
			<td><%= getZgInfo(zgqun[i+j]) %></td>
		<% } %>			
	</tr>
    <% } %>	
</tbody>
</table>
</script>

<script id='t_god' type='text/html'>
<table border width='100%' id='tbl_god'>
<tbody>
    <% for (i = 0; i<zggod.length; i+=10) { %>		
    <tr>
		<% for (j = 0; j<10; j++) { %>
			<td><%= getZgInfo(zggod[i+j]) %></td>
		<% } %>			
	</tr>
    <% } %>	
</tbody>
</table>
</script>

<script id='t_3v3' type='text/html'>
<table border width='100%' id='tbl_3v3'>
<tbody>
    <% for (i = 0; i<zg3v3.length; i+=10) { %>		
    <tr>
		<% for (j = 0; j<10; j++) { %>
			<td><%= getZgInfo(zg3v3[i+j]) %></td>
		<% } %>			
	</tr>
    <% } %>	
</tbody>
</table>
</script>

<script id='t_1v1' type='text/html'>
<table border width='100%' id='tbl_1v1'>
<tbody>
    <% for (i = 0; i<zg1v1.length; i+=10) { %>		
    <tr>
		<% for (j = 0; j<10; j++) { %>
			<td><%= getZgInfo(zg1v1[i+j]) %></td>
		<% } %>			
	</tr>
    <% } %>	
</tbody>
</table>
</script>


<script type="text/javascript">
var callback={
	getTrans:function(v){
		return trans[v] || v;
	},
	getGeneral:function(v){
		return "<img height='20' src='../image/generals/tiny/"+v+".png'/>"+(trans[v] || v);
	},	
	getRole:function(v){
		return "<img height='20' src='../image/system/roles/"+v+"-1.png'/>"+(trans[v] || v);
	},
	getStatus:function(v){
		return v==1 ? "是":"否";
	},
	getZgInfo:function(info){
		if (!info)	return "<div style='width:53px'>&nbsp;</div>";
		var imgsrc="./img/"+info.id+".png";
		if ($.inArray(info.category,["wei","shu","wu","qun","god"])!=-1 && info.general!=='-'){
			imgsrc="../image/generals/avatar/"+info.general+".png";
			if ($.inArray(info.general,["guanxingzhangbao","erzhang","yanliangwenchou"])!=-1){
				imgsrc="../image/generals/big/"+info.general+".png";
			}
		}
		var enableStr= info.gained >0 ? "" : " class='graycolor'";
		return "<div style='text-align:center;margin:3px' title='"+info.description
				+"'><img height='53' src='"+imgsrc+"' "+enableStr+"/><div style='margin-top:6px;'"
				+enableStr+">"+info.name+"</div></div>";
	}
};

$.each(callback,function(name,func){	
	template.helper(name,func)
});

var tabLists=$.merge(["overview","results","skills"],zglist);
var tabPageNum=[100,12,100,5,5,5,5,5,5,5,5];

$(function(){
	$("a").click(function(){		
		$(this).blur();
	});		
	$.each(tabLists,function(i,tab){
		$("#link_"+tab).click(function(){
			$.each(tabLists,function(i,val){
				$("#div_"+val).hide();
				$("#link_"+val).css("color","highlight");
			});
			$("#div_"+tab).show();
			$("#link_"+tab).css("color","red");						
		})
		$("#tbl_"+tab +" tr").each(function(i){
			if (i%2==0) $(this).css("background","#f5f5f5");			
		})
	});
	$("#link_zhonghe").trigger("click");			
});
</script>



<div class="page">
	<div id="header">		
		<div id="nav">
			[ <a href="http://qsanguosha.org/" target="_blank">论坛讨论贴</a> ] 
			[ <a href="https://github.com/haveatry823/qsgsext" target="_blank" title="本程序的git开源项目地址">github</a> ] 
			[ <a href="https://code.google.com/p/qsgsext/" target="_blank" title="本程序的SVN开源项目地址">google code</a> ]
			[ <a href="mailto:haveatry823@qq.com" target="_blank">联系作者</a> ]
		</div>
		<div id="menucontainer">
			<ul id="menu">              
				<li><a id="link_overview" href="#">概况总结</a></li>
				<li><a id="link_zhonghe" href="#">综合</a></li>
				<li><a id="link_wei" href="#">魏</a></li>
				<li><a id="link_shu" href="#">蜀</a></li>
				<li><a id="link_wu" href="#">吴</a></li>
				<li><a id="link_qun" href="#">群</a></li>
				<li><a id="link_god" href="#">神</a></li>
				<li><a id="link_3v3" href="#">3v3</a></li>
				<li><a id="link_1v1" href="#">1v1</a></li>
				<li><a id="link_skills" href="#">技能卡</a></li>
				<li><a id="link_results" href="#">游戏记录</a></li>				
			</ul>            
		</div>
	</div>
    <div id="main">
		<script type="text/javascript">
			$.each(tabLists,function(i,tab){
				document.write('<div id="div_'+tab+'" style="display:none">');
				document.write(template('t_'+tab, data));
				document.write('</div>');
				$("#tbl_"+tab).tablePaging({ pageSize: tabPageNum[i],sorting:false, fillBlank:true});
			});			
		</script>		
    </div>
</div>
</body>
</html>